{{ template "dashboard/header" . }}
<body class="d-flex flex-column min-vh-100 bg-light">

    <header class="bg-dark text-white text-center p-3">
        <h2>Flashcards.io | Add New Card</h2>
    </header>

    <main class="container my-5">
        <div class="mb-3">
            <button class="btn btn-secondary" onclick="history.back()">Back</button>
        </div>
        <div class="row my-5 justify-content-center">
            <div class="col-md-8">
                <div class="card shadow">
                    <div class="card-body">
                        <h3>Add a New Card to {{.Box.Name}}</h3>
                        {{if .Message}}
                            <div class="alert alert-success" role="alert">
                                {{.Message}}
                            </div>
                        {{end}}
                        {{if .ErrorMessage}}
                            <div class="alert alert-danger" role="alert">
                                {{.ErrorMessage}}
                            </div>
                        {{end}}
                        <form action="/web/dashboard/box/{{.Box.IDString}}/card" method="POST">
                            <input type="hidden" name="csrf_token" value="{{.csrfToken}}">
                            <div class="mb-3">
                                <label for="cardFront" class="form-label">Front</label>
                                <input type="text" class="form-control" id="cardFront" name="front" placeholder="front..." required>
                            </div>
                            <div class="mb-3">
                                <label for="cardBack" class="form-label">Back</label>
                                <input type="text" class="form-control" id="cardBack" name="back" placeholder="back..." required>
                            </div>
                            <div class="mb-3">
                                <label for="cardBack" class="form-label">write extra info...</label>
                                <textarea rows="5" class="form-control" id="cardExtra" name="extra" placeholder="extra info ... "></textarea>
                            </div>
                            <!-- <div class="mb-3" id="repeaterContainer">
                                <label for="cardKey" class="form-label">Key-Value Pairs</label>
                                <div class="d-flex mb-2">
                                    <input type="text" class="form-control me-2" name="key[]" placeholder="Text Key" required>
                                    <input type="text" class="form-control" name="value[]" placeholder="Text Value" required>
                                    <button type="button" class="btn btn-danger removeRepeater">Remove</button>
                                </div>
                                <button type="button" id="addRepeater" class="btn btn-link">+ Add Another Key-Value Pair</button>
                            </div> -->
                            <div class="mb-3">
                                <label for="cardStage" class="form-label">Stage</label>
                                <select class="form-select" id="cardStage" name="stageId" required>
                                    <option disabled value="">select one stage</option>
                                    {{range .Stages}}
                                        <option 
                                            {{if .IsDefault}}
                                                selected
                                            {{end}}
                                            value="{{.IDString}}">{{.Name}}
                                        </option>
                                    {{end}}
                                </select>
                            </div>   
                            <div class="mb-3">
                                <label for="labelIds" class="form-label">Labels</label>
                                <select class="form-select" id="labelIds" name="labelIds[]" >
                                    {{range .Labels}}
                                        <option value="{{.IDString}}">{{.Name}}</option>
                                    {{end}}
                                </select>
                            </div>              
                            <div class="text-end">
                                <button type="submit" class="btn btn-primary">Add Card</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    {{ template "dashboard/footer" . }}
</body>
<script>
    document.getElementById('addRepeater').addEventListener('click', function() {
        const container = document.getElementById('repeaterContainer');
        
        const newPair = document.createElement('div');
        newPair.classList.add('d-flex', 'mb-2');
        newPair.innerHTML = `
            <input type="text" class="form-control me-2" name="key[]" placeholder="Text Key" required>
            <input type="text" class="form-control" name="value[]" placeholder="Text Value" required>
        `;
        
        container.insertBefore(newPair, this);
    });

    document.addEventListener('click', function(event) {
        if (event.target && event.target.classList.contains('removeRepeater')) {
            const pair = event.target.closest('.d-flex');
            pair.remove();
        }
    });
</script>
</html>